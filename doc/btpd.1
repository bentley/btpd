.Dd May 10, 2015
.Dt BTPD 1
.Os
.Sh NAME
.Nm btpd
.Nd BitTorrent Protocol Daemon
.Sh SYNOPSIS
.Nm btpd
.Op Fl d Ar dir
.Op Fl p Ar port
.Op Ar options ...
.Sh DESCRIPTION
.Nm
is a utility for sharing files over the BitTorrent network protocol.
It runs in daemon mode, thus needing no controlling terminal or gui.
Instead, the daemon is controlled by
.Xr btcli 1 ,
its control utility, or other programs capable of sending commands and queries
on the control socket.
.Pp
.Nm
consists of the following programs:
.Bl -tag -width btinfo(1)XX
.It Nm btpd
The bittorrent client.
.It Xr btcli 1
Command line interface to btpd.
.It Xr btinfo 1
Shows information from a torrent file.
.El
.Pp
All programs accept the
.Fl -help
option.
.Sh OPTIONS
.Bl -tag -width Ds
.It Fl d Ar dir
The path for the btpd directory.
Default is
.Pa $HOME/.btpd .
.It Fl p Ar n , Fl -port Ar n
Listen at port
.Ar n .
Default is 6881.
.It Fl -help Op Ar mode
Show this text or help for the specified mode.
.It Fl 4
Use IPv4.
If given in conjunction with
.Fl 6 ,
both versions are used.
.It Fl 6
Use IPv6.
By default IPv4 is used.
.Pp
Unfortunately enabling both IPv6 and IPv4 in btpd is less useful than it should
be.
The problem is that some sites have trackers for both versions and it's likely
that the IPv6 one, which probably has less peers, will be used in favour of the
IPv4 one.
.It Fl -bw-in Ar n
Limit incoming BitTorrent traffic to
.Ar n
kB/s.
Default is 0 which means unlimited.
.It Fl -bw-out Ar n
Limit outgoing BitTorrent traffic to
.Ar n
kB/s.
Default is 0 which means unlimited.
.It Fl -empty-start
Start
.Nm
without any active torrents.
.It Fl -ip Ar addr
Let the tracker distribute the given address instead of the one it sees
.Nm
connect from.
.It Fl -ipcprot Ar mode
Set the protection mode of the command socket.
The mode is specified by an octal number.
Default is 0600.
.Fl -logfile Ar file
Where to put the logfile.
By default it's put in the
.Nm
dir.
.It Fl -logmask Ar mask
Bitfield to specify which data to record in the
.Nm
log (dev info).
.It Fl -max-peers Ar n
Limit the amount of peers to
.Ar n .
.It Fl -max-uploads Ar n
Controls the number of simultaneous uploads.
The possible values are:
.Bl -inset
.It < \(mi1
Choose
.Ar n
\(>= 2 based on
.Fl -bw-out
(default).
.It = \(mi1
Upload to every interested peer.
.It = 0
Don't upload to anyone.
.It > 0
Upload to at most n peers simultaneously.
.El
.It Fl -no-daemon
Keep the
.Nm
process in the foregorund and log to
.Dv stdout
and
.Dv stderr .
This option is intended for debugging purposes.
.It Fl -prealloc Ar n
Preallocate disk space in chunks of
.Ar n
kB.
Default is 2048.
Note that
.Ar n
will be rounded up to the closest multiple of the torrent piece size.
If
.Ar n
is zero no preallocation will be done.
.It Fl -numwant Ar n
Specify the number of wanted peers
.Sq numwant
tracker request parameter.
Default is 50.
.El
.Sh STARTING BTPD
To start btpd with default settings you only need to run it with no arguments.
However, there are many useful options you may want to use.
To see a full list run
.Nm
.Fl -help .
If you didn't specify otherwise,
.Nm btpd
starts with the same set of active torrents as it had the last time it was shut
down.
.Pp
.Nm btpd
will store information and write its log in
.Pa $HOME/.btpd .
Therefore it needs to be able to write there during its execution.
You can specify another directory via the
.Fl d
option or the
.Ev BTPD_HOME
variable.
.Pp
It is recommended to specify the maximum number of uploads.
Bittorrent employs a tit for tat algorithm,
so uploading at good rates allows for downloading.
Try to find a balance between uploads/outgoing bandwidth and the number of
active torrents.
.Pp
.Sy Note :
You should only need one instance of
.Nm
regardless of how many torrents you want to share.
.Sh EXAMPLES
Start
.Nm
with all options set to their default values.
.Dl $ btpd
.Pp
Start
.Nm
as above, but with torrent data in the directory
.Pa /var/torrents .
.Dl $ btpd -d /var/torrents
.Pp
Start btpd and make it listen on port 12345,
limit outgoing bandwidth to 200kB/s,
limit the number of peers to 40
and not start any torrents that were active the last time
.Nm
was shut down.
.Dl $ btpd -p 12345 --bw-out 200 --max-peers 40 --empty-start
.Sh TROUBLESHOOTING
If
.Nm
has shut down for some unknown reason, check the logfile for possible clues.
.Sh SEE ALSO
.Xr btcli 1 ,
.Xr btinfo 1
.Sh AUTHORS
.An -nosplit
Current maintainers:
.Bl -bullet
.It
.An Marq Schneider Aq Mt queueRAM@gmail.com
.El
.Pp
Past contributors:
.Bl -bullet
.It
Richard Nyberg
.Aq Mt btpd@murmeldjur.se
.El
.Sh BUGS
Known bugs are listed at
.Lk http://github.com/btpd/btpd/issues .
.Pp
Before submitting a bug report,
please verify that you are running the latest version of
.Nm btpd .
